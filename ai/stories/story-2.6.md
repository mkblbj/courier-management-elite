# Story 2.6: 店铺排序功能

## Story

**As a** 系统管理员  
**I want** 能够调整店铺的显示顺序  
**so that** 我可以按照业务重要性或其他逻辑方式组织店铺列表，提高日常操作效率。

## Status

not started

## Context

系统中的店铺列表默认可能按照创建时间或名称排序，但这可能不符合用户的业务需求。本故事将实现自定义店铺排序功能，允许管理员通过拖拽方式调整店铺的显示顺序，并支持按类别分组排序。

排序功能将影响店铺在列表中的显示顺序，以及在出力数据录入、统计分析等功能中的显示顺序，提高用户体验和操作效率。

## Estimation

Story Points: 3

## Acceptance Criteria

1. - [ ] 在店铺列表页面添加"调整排序"按钮
2. - [ ] 点击"调整排序"按钮时，弹出排序对话框
3. - [ ] 排序对话框按类别分组显示店铺列表
4. - [ ] 每个类别有明确的标题
5. - [ ] 每个店铺项前面有拖动手柄图标
6. - [ ] 支持通过拖拽调整店铺的顺序，但仅限于同一类别内
7. - [ ] 拖拽时有适当的视觉反馈，如阴影效果或背景色变化
8. - [ ] 对话框底部有"取消"和"保存排序"按钮
9. - [ ] 点击"保存排序"按钮时显示加载状态
10. - [ ] 保存成功后关闭对话框，并刷新店铺列表，显示新的排序
11. - [ ] 保存失败时显示错误消息
12. - [ ] 整体视觉风格与系统的其他对话框保持一致

## Subtasks

1. - [ ] 创建店铺排序模态对话框组件
   1. - [ ] 完善 components/shop/ShopSortModal.tsx 组件
   2. - [ ] 实现按类别分组的列表布局
   3. - [ ] 添加类别标题和分隔设计
2. - [ ] 实现拖拽排序功能
   1. - [ ] 集成 @dnd-kit 库实现拖拽功能
   2. - [ ] 实现同一类别内的排序限制
   3. - [ ] 添加拖拽时的视觉反馈
   4. - [ ] 实现拖拽完成后的数据结构更新
3. - [ ] 实现排序 API 集成
   1. - [ ] 完善 lib/api/shop.ts 中的更新店铺排序 API
   2. - [ ] 在保存排序时调用 API
   3. - [ ] 实现加载状态和错误处理
4. - [ ] 更新店铺列表组件
   1. - [ ] 添加"调整排序"按钮
   2. - [ ] 集成店铺排序对话框
   3. - [ ] 实现排序保存成功后的列表更新逻辑
5. - [ ] 样式优化和交互完善
   1. - [ ] 确保拖拽操作的流畅性和用户体验
   2. - [ ] 优化类别标题和分隔线的视觉设计

## Testing Requirements:

- 单元测试覆盖率 >= 85%
- 对排序对话框组件进行组件测试
- 测试拖拽排序功能的正确性
- 测试排序保存的 API 集成是否正确
- 测试排序后列表更新的正确性
- 进行手动测试，验证拖拽交互体验

## Notes

- 使用 shadcn/ui 的 Dialog 组件实现排序对话框
- 使用 @dnd-kit/core、@dnd-kit/sortable 和 @dnd-kit/modifiers 库实现拖拽排序功能
- 使用 lucide-react 的 GripVertical 图标作为拖动手柄
- 类别标题使用浅色背景区分，店铺列表项之间有分隔线
- 拖拽项在拖动时应有阴影效果和轻微放大，提供明确的视觉反馈
- 实现时需要考虑键盘操作，支持无障碍使用
- 参考 v0dev 生成的店铺排序功能组件设计
