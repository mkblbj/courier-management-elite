# Story 3.8: 高级筛选面板

## Story

**As a** 系统管理员  
**I want** 有一个功能强大的高级筛选面板  
**so that** 我可以通过多种条件组合查询，精确地找到和分析我需要的出力数据。

## Status

pending

## Context

随着出力数据量的增加，用户需要能够更精细地筛选和查询数据。高级筛选面板将允许用户通过组合多个条件（日期、店铺类别、店铺、快递类型等）来过滤数据，使得数据查询更加精确和高效。

该功能将以折叠面板的形式实现，默认折叠状态，用户点击"筛选条件"按钮后展开，完成筛选条件设置后，系统根据条件过滤并显示数据，同时计算符合条件的数据总量。

## Estimation

Story Points: 5

## Acceptance Criteria

1. - [ ] 为出力数据页面的 `app/output-data/components/OutputSummary.tsx` 组件添加一个折叠式的高级筛选面板
   - 默认为折叠状态
   - 点击"筛选条件"按钮展开面板
   - 面板展开和折叠时有平滑动画效果
2. - [ ] 筛选面板包含以下筛选条件：
   - 日期范围选择（起始日期和结束日期）
   - 店铺类别多选下拉框，支持搜索功能
   - 店铺多选下拉框，支持搜索功能，可根据所选类别动态筛选可选店铺
   - 快递类型多选下拉框，支持搜索功能
3. - [ ] 筛选面板底部有"重置"和"应用筛选"按钮
   - "重置"按钮清空所有筛选条件
   - "应用筛选"按钮触发数据过滤
4. - [ ] 应用筛选后，数据表格和汇总信息根据筛选条件更新
5. - [ ] 在筛选结果上方显示符合条件的数据总量
6. - [ ] 实现筛选条件的组合逻辑，支持各种条件的"与"操作
7. - [ ] 筛选状态应保持，直到用户修改筛选条件或重置
8. - [ ] 支持响应式设计，在移动设备上合理布局
9. - [ ] 筛选条件应持久化，页面刷新后保持上次的筛选设置

## Subtasks

1. - [ ] 创建筛选面板组件
   1. - [ ] 在 `app/output-data/components/FilterPanel.tsx` 中实现折叠式筛选面板组件
   2. - [ ] 实现展开/折叠动画效果
   3. - [ ] 设计卡片式样式，包含阴影和圆角
2. - [ ] 实现日期选择器
   1. - [ ] 使用 `frontend/app/output-data/components/DateSelector.tsx` 组件实现日期选择
   2. - [ ] 添加日期逻辑
3. - [ ] 实现类别多选下拉框
   1. - [ ] 使用 shadcn/ui 的 MultiSelect 组件实现类别多选
   2. - [ ] 集成搜索功能
   3. - [ ] 处理数据加载和空数据状态
4. - [ ] 实现店铺多选下拉框
   1. - [ ] 创建支持多选的店铺选择组件
   2. - [ ] 实现按所选类别动态筛选店铺的功能
   3. - [ ] 集成搜索功能
5. - [ ] 实现快递类型多选下拉框
   1. - [ ] 创建支持多选的快递类型选择组件
   2. - [ ] 集成搜索功能
6. - [ ] 实现筛选逻辑
   1. - [ ] 创建筛选状态管理逻辑
   2. - [ ] 实现各筛选条件的组合过滤算法
   3. - [ ] 优化查询性能，避免不必要的重复计算
7. - [ ] 筛选结果处理
   1. - [ ] 实现数据过滤和更新逻辑
   2. - [ ] 添加筛选结果计数显示
   3. - [ ] 处理无匹配结果的情况
8. - [ ] 筛选状态持久化
   1. - [ ] 使用 localStorage 或 URL 参数实现筛选状态持久化
   2. - [ ] 添加页面加载时恢复筛选状态的逻辑
9. - [ ] 移动端适配
   1. - [ ] 优化移动设备下的组件布局
   2. - [ ] 确保触摸友好的交互体验

## Testing Requirements:

- 单元测试覆盖率 >= 85%
- 组件测试：验证筛选面板的渲染和交互逻辑
- 功能测试：验证各筛选条件的组合效果
- 集成测试：验证筛选面板与数据表格、汇总区域的联动
- 测试边界情况：空选项、全选、无匹配结果等
- 测试筛选状态持久化功能
- 性能测试：评估大数据量下的筛选效率
- 移动端兼容性测试

## Notes

- 使用 shadcn/ui 的 Accordion 或 Collapsible 组件实现折叠面板
- 多选下拉框考虑使用 shadcn/ui 的 Command 组件或第三方组件如 react-select
- 筛选面板的设计应与整体 UI 风格一致，使用统一的配色和间距
- 为提高用户体验，考虑在筛选条件变更时实时显示匹配的记录数
- 参考 v0dev 生成的筛选和搜索面板组件设计
- 按照 UI-draft.md 中 2.2 部分的筛选和搜索面板设计实现界面
- 考虑添加筛选条件的保存功能，允许用户保存常用的筛选组合
- 筛选逻辑应在前端实现，但考虑后续可能的后端筛选 API 集成
