# Story 4.2: 统计维度选择功能

## Story

**As a** 系统管理员  
**I want** 能够选择不同的统计维度来分析店铺出力数据  
**so that** 我可以从多个角度理解业务情况，做出更明智的决策。

## Status

Ready for Development

## Context

出力数据可以从多个维度进行统计分析，包括按店铺类别、按店铺、按快递类型和按日期等。不同的维度可以帮助用户从不同的角度理解业务情况，发现问题和机会。本故事将实现统计维度选择功能，允许用户在统计分析页面中自由切换不同的统计维度，并动态加载相应的数据和展示形式。

这是统计分析功能的核心部分，为后续实现各个具体统计维度的功能提供基础框架。该功能需要与统计分析页面（故事 4.1）紧密集成，确保用户体验流畅和一致。

## Estimation

Story Points: 2

## Acceptance Criteria

1. - [ ] 在统计控制面板中实现维度选择按钮组，包含以下选项：
   - 按店铺类别统计
   - 按店铺统计
   - 按快递类型统计
   - 按日期统计
2. - [ ] 当前选中的维度应有明显的视觉区分
3. - [ ] 切换维度时，系统应根据选择动态更新筛选器区域的可用选项
4. - [ ] 切换维度时，系统应动态调整数据展示区域的表格和图表类型
5. - [ ] 在切换维度的过程中，显示适当的加载状态
6. - [ ] 保持用户选择的时间范围和其他筛选条件（如果在新维度中仍然适用）
7. - [ ] 支持通过 URL 参数指定默认的统计维度
8. - [ ] 用户的维度选择应在页面刷新后保持
9. - [ ] 维度切换功能在移动设备上也能正常工作

## Subtasks

1. - [ ] 实现维度选择组件
   1. - [ ] 在 `StatsControlPanel.tsx` 中完善维度选择按钮组
   2. - [ ] 实现当前维度的视觉标识
   3. - [ ] 添加键盘导航支持（如左右键切换维度）
2. - [ ] 实现维度切换逻辑
   1. - [ ] 创建维度状态管理钩子
   2. - [ ] 实现维度切换事件处理
   3. - [ ] 实现维度状态的持久化（localStorage 或 URL 参数）
3. - [ ] 实现筛选器动态更新
   1. - [ ] 创建筛选器配置管理逻辑
   2. - [ ] 为每个维度定义适用的筛选条件
   3. - [ ] 实现维度切换时筛选器的动态调整
4. - [ ] 实现数据展示区域动态调整
   1. - [ ] 创建表格配置管理逻辑
   2. - [ ] 创建图表配置管理逻辑
   3. - [ ] 实现维度切换时表格和图表的动态切换
5. - [ ] 实现数据加载逻辑
   1. - [ ] 创建维度相关的数据获取服务
   2. - [ ] 实现维度切换时的数据刷新
   3. - [ ] 优化数据加载性能，避免不必要的重复请求
6. - [ ] 集成移动端适配
   1. - [ ] 优化小屏幕下的维度选择控件
   2. - [ ] 确保触摸操作的准确性和易用性
7. - [ ] 将维度选择功能与整体统计页面集成
   1. - [ ] 确保维度选择影响整个页面的状态和显示
   2. - [ ] 测试维度切换时各组件的协调工作

## Testing Requirements:

- 单元测试覆盖率 >= 85%
- 对维度选择组件进行组件测试，验证渲染和交互逻辑
- 测试维度切换逻辑和状态管理
- 测试筛选器和数据展示区域的动态更新
- 测试维度状态的持久化功能
- 测试在不同屏幕尺寸下的响应式行为
- 进行端到端测试，验证整个功能流程

## Notes

- 使用 shadcn/ui 的 ToggleGroup 或 ButtonGroup 组件实现维度选择按钮组
- 考虑使用 Icon + 文本的组合提高维度选择的可识别性
- 建议为每个维度使用不同颜色的强调色，提高视觉区分度
- 维度切换应有平滑的过渡动画，提升用户体验
- 确保维度选择按钮在小屏幕上能够适当换行或滚动
- 考虑添加键盘快捷键（如 1-4 数字键）快速切换维度
- 维度切换时，应保留用户已选的筛选条件，除非它们与新维度不兼容
- 维度选择功能应是响应式的，而不是单纯的路由切换，以提供更流畅的体验
