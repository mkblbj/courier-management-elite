# Story 2.2: 店铺添加功能

## Story

**As a** 系统管理员  
**I want** 能够添加新的店铺信息到系统中  
**so that** 我可以管理新开设的店铺并跟踪其出力数据。

## Status

complete

## Context

随着业务发展，系统中需要添加新的店铺信息。本故事将实现添加新店铺的功能，包括店铺名称、所属类别、备注和状态等信息的录入。这是店铺管理功能的重要组成部分，将为后续的出力数据管理提供基础数据支持。

添加店铺功能需要与店铺类别管理功能相结合，确保新店铺能够正确关联到已有的店铺类别。

## Estimation

Story Points: 3

## Acceptance Criteria

1. - [ ] 在店铺列表页面添加"添加店铺"按钮
2. - [ ] 点击"添加店铺"按钮时，弹出添加店铺对话框
3. - [ ] 添加店铺对话框包含以下字段：
   - 店铺名称（必填文本输入框）
   - 所属类别（必选下拉选择框，显示所有可用类别）
   - 备注（可选多行文本框）
   - 状态（单选按钮组，选项为"启用"和"禁用"，默认"启用"）
4. - [ ] 实现表单验证逻辑，包括：
   - 店铺名称不能为空
   - 所属类别必须选择
5. - [ ] 表单提交时显示加载状态
6. - [ ] 提交成功后关闭对话框，并在列表中显示新添加的店铺
7. - [ ] 提交失败时显示错误消息
8. - [ ] 对话框底部有"取消"和"确认"按钮，点击"取消"或对话框外部可关闭对话框
9. - [ ] 对话框的视觉设计与系统的其他对话框保持一致

## Subtasks

1. - [ ] 创建店铺表单组件
   1. - [ ] 完善 components/shop/ShopForm.tsx 组件
   2. - [ ] 实现表单布局和样式
   3. - [ ] 集成所属类别的下拉选择框
   4. - [ ] 实现状态单选按钮组
   5. - [ ] 添加表单验证逻辑
2. - [ ] 创建添加店铺对话框组件
   1. - [ ] 使用 shadcn/ui 的 Dialog 组件创建对话框
   2. - [ ] 集成店铺表单组件
   3. - [ ] 实现对话框的打开和关闭逻辑
   4. - [ ] 添加取消和确认按钮
3. - [ ] 实现添加店铺 API 集成
   1. - [ ] 完善 lib/api/shop.ts 中的创建店铺 API
   2. - [ ] 在表单提交时调用创建 API
   3. - [ ] 实现加载状态和错误处理
4. - [ ] 更新店铺列表组件
   1. - [ ] 添加"添加店铺"按钮
   2. - [ ] 集成添加店铺对话框
   3. - [ ] 实现添加成功后的列表更新逻辑
5. - [ ] 样式优化和交互完善
   1. - [ ] 确保视觉一致性
   2. - [ ] 优化表单字段的布局和间距
   3. - [ ] 添加适当的表单提示和帮助文本

## Testing Requirements:

- 单元测试覆盖率 >= 85%
- 对表单组件进行组件测试，验证验证逻辑
- 测试 API 集成是否正确
- 测试表单提交成功和失败的场景
- 验证添加店铺后列表更新的正确性
- 手动测试用户交互体验

## Notes

- 使用 shadcn/ui 的 Dialog 组件实现对话框
- 使用 shadcn/ui 的 Form 组件实现表单
- 使用 zod 库实现表单验证
- 参考 v0dev 生成的店铺添加/编辑对话框组件设计
- 所有输入控件使用全宽设计，字段之间有适当间距
- 必填字段未填写时显示错误提示
