# Story 1.4: 店铺类别删除功能

## Story

**As a** 系统管理员  
**I want** 能够删除不再需要的店铺类别  
**so that** 我可以保持系统数据的整洁和相关性。

## Status

Ready for Development

## Context

随着业务的变化，某些店铺类别可能不再需要使用。这个功能将在完成店铺类别列表展示（Story 1.1）之后实现，允许用户删除不再需要的店铺类别。

本故事将实现删除店铺类别的功能，包括在类别列表中添加删除按钮、创建删除确认对话框、实现删除逻辑以及与后端 API 的交互。同时，考虑到数据完整性，系统需要检查是否有店铺关联到该类别，若有则需要提供适当的提示。

## Estimation

Story Points: 2

## Acceptance Criteria

1. - [ ] 在店铺类别列表的每一行添加"删除"按钮
2. - [ ] 点击"删除"按钮打开删除确认对话框
3. - [ ] 删除确认对话框包含以下内容：
   - 对话框标题："删除店铺类别"
   - 确认信息："确定要删除类别 [类别名称] 吗？此操作不可撤销。"
   - 取消按钮和确认按钮
4. - [ ] 点击确认按钮时，向后端 API 发送删除请求
5. - [ ] 删除成功后：
   - 关闭对话框
   - 从列表中移除该类别
   - 显示成功消息
6. - [ ] 若该类别已关联店铺，删除失败时：
   - 显示适当的错误消息："该类别已关联店铺，无法删除。请先移除关联的店铺或将店铺更换到其他类别。"
7. - [ ] 其他类型的删除失败时，显示通用错误消息
8. - [ ] 点击取消按钮关闭对话框，不进行任何操作
9. - [ ] 对话框的整体视觉风格与系统保持一致

## Subtasks

1. - [ ] 实现类别列表中的"删除"按钮
   1. - [ ] 在 CategoryList.tsx 组件的每一行添加删除按钮
   2. - [ ] 设计按钮样式和位置
   3. - [ ] 实现点击事件处理
2. - [ ] 实现删除确认对话框
   1. - [ ] 创建 DeleteConfirmDialog 组件
   2. - [ ] 实现对话框内容和样式
   3. - [ ] 实现对话框打开和关闭逻辑
3. - [ ] 实现 API 交互
   1. - [ ] 在 lib/api/shop-category.ts 中实现删除类别 API
   2. - [ ] 在组件中集成 API 调用
   3. - [ ] 实现加载状态和错误处理
4. - [ ] 实现错误处理逻辑
   1. - [ ] 处理类别已关联店铺的情况
   2. - [ ] 处理其他可能的错误情况
5. - [ ] 实现成功/失败提示
   1. - [ ] 在不同操作结果下显示适当的提示
6. - [ ] 实现列表更新逻辑
   1. - [ ] 删除成功后从列表中移除该类别
   2. - [ ] 无需完全刷新列表数据，优化性能

## Testing Requirements:

- 单元测试覆盖率 >= 85%
- 对删除确认对话框组件进行组件测试，验证渲染和交互逻辑
- 测试 API 集成是否正确
- 模拟 API 成功和不同类型失败的情况，测试错误处理
- 验证删除操作后的状态更新和 UI 变化

## Notes

- 使用 shadcn/ui 的 AlertDialog 组件实现删除确认对话框
- 删除操作属于危险操作，确保 UI 上有足够的警示（如红色删除按钮）
- 确保删除确认信息清晰表达操作的不可撤销性
- 考虑在后端实现检查是否有关联店铺的逻辑
