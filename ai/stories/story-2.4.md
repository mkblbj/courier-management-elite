# Story 2.4: 发货记录统计功能更新

## Story

**As a** 物流管理员和业务分析师
**I want** 查看带有母子类型层级关系的发货记录统计数据
**so that** 我可以全面了解各类型快递的发货情况，包括母类型自身和子类型的详细发货数据。

## Status

Draft

## Context

随着母子快递类型功能的实现，发货记录统计功能也需要更新，以支持母子类型数据的分层展示和汇总。用户需要能够查看母类型的发货记录（包含自身和子类型的汇总），同时也能按需查看仅包含母类型自身的记录，以便更灵活地分析发货数据。

## Estimation

Story Points: 3

## Acceptance Criteria

1. - [ ] 创建`shipping-hierarchy-view.tsx`组件，以层级结构显示发货记录数据
2. - [ ] 区分显示母类型自身记录和子类型汇总数据
3. - [ ] 支持按日期筛选层级数据
4. - [ ] 更新发货记录详情页，如果查看的是母类型，显示其自身和子类型的发货记录
5. - [ ] 提供"仅查看自身记录"和"包含子类型记录"的切换选项
6. - [ ] 确保数据加载和筛选操作的性能良好
7. - [ ] 提供清晰的数据来源提示，区分自身数据和汇总数据

## Subtasks

1. - [ ] 数据获取和处理

   1. - [ ] 创建获取层级发货记录数据的 API 调用
   2. - [ ] 实现数据处理逻辑，支持母子类型数据的识别和分组
   3. - [ ] 添加日期筛选逻辑，确保筛选同时应用到母类型和子类型

2. - [ ] 创建`shipping-hierarchy-view.tsx`组件

   1. - [ ] 实现基础组件结构和布局
   2. - [ ] 添加层级数据显示功能
   3. - [ ] 实现母类型和子类型的视觉区分
   4. - [ ] 添加交互控件，支持数据视图切换

3. - [ ] 更新发货记录详情页

   1. - [ ] 添加类型判断，识别母类型和子类型
   2. - [ ] 为母类型添加显示自身和子类型记录的功能
   3. - [ ] 实现视图切换选项，支持仅查看自身记录
   4. - [ ] 添加数据来源提示，明确区分自身和汇总数据

4. - [ ] 添加数据分析功能

   1. - [ ] 实现基本的数据统计和汇总
   2. - [ ] 添加数据可视化图表，展示母子类型发货分布
   3. - [ ] 提供数据导出功能，包含层级结构信息

5. - [ ] 测试和优化
   1. - [ ] 编写组件单元测试
   2. - [ ] 进行性能测试，确保大数据量下的加载和渲染性能
   3. - [ ] 测试各种数据场景，包括无子类型、多层子类型等
   4. - [ ] 用户体验测试，确保界面直观易用

## Testing Requirements

- 单元测试覆盖率不低于 85%
- 确保组件在大数据量下的性能稳定
- 测试日期筛选功能在各种日期范围下的正确性
- 验证母类型汇总数据的准确性
- 确保 UI 组件在桌面和移动设备上的响应式布局正常

## Story Wrap Up (To be filled in AFTER agent execution):

- **Agent Model Used:** `<Agent Model Name/Version>`
- **Agent Credit or Cost:** `<Cost/Credits Consumed>`
- **Date/Time Completed:** `<Timestamp>`
- **Commit Hash:** `<Git Commit Hash of resulting code>`
- **Change Log**
  - change X
  - change Y
    ...
