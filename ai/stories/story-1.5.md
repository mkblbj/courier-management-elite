# Story 1.5: 店铺类别排序功能

## Story

**As a** 系统管理员  
**I want** 能够调整店铺类别的显示顺序  
**so that** 我可以根据业务需求自定义类别的展示优先级，提升用户体验。

## Status

Ready for Development

## Context

店铺类别的展示顺序对于用户体验有重要影响。这个功能将在完成店铺类别列表展示（Story 1.1）之后实现，允许用户通过拖拽排序方式自定义店铺类别的显示顺序。

本故事将实现调整店铺类别排序的功能，包括创建排序按钮、排序对话框、拖拽排序界面以及与后端 API 的交互，确保用户能够直观地调整类别顺序并保存设置。

## Estimation

Story Points: 3

## Acceptance Criteria

1. - [ ] 在店铺类别列表页面添加"调整排序"按钮，位于表格上方
2. - [ ] 点击"调整排序"按钮打开排序对话框
3. - [ ] 排序对话框包含以下内容：
   - 对话框标题："调整类别排序"
   - 可拖拽的类别列表，每项前面有拖动手柄图标
   - 取消按钮和保存排序按钮
4. - [ ] 实现拖拽排序功能：
   - 鼠标悬停在项目上显示可拖拽提示
   - 拖动项目时有视觉反馈（如阴影效果和轻微放大）
   - 拖动过程中列表自动调整位置
5. - [ ] 点击保存排序按钮时，向后端 API 发送更新请求，包含所有类别及其新顺序
6. - [ ] 保存成功后：
   - 关闭对话框
   - 刷新类别列表，显示新的排序顺序
   - 显示成功消息
7. - [ ] 保存失败时显示错误消息
8. - [ ] 点击取消按钮关闭对话框，不保存更改
9. - [ ] 对话框的整体视觉风格与系统保持一致

## Subtasks

1. - [ ] 实现"调整排序"按钮
   1. - [ ] 在 CategoryList.tsx 组件中添加按钮
   2. - [ ] 设计按钮样式和位置
   3. - [ ] 实现点击事件处理
2. - [ ] 实现排序对话框
   1. - [ ] 完善 components/shop-category/CategorySortModal.tsx 组件
   2. - [ ] 实现对话框基本布局和样式
   3. - [ ] 实现对话框打开和关闭逻辑
3. - [ ] 实现拖拽排序功能
   1. - [ ] 集成@dnd-kit/sortable 库
   2. - [ ] 创建可排序列表组件
   3. - [ ] 实现拖拽排序逻辑和状态管理
   4. - [ ] 添加拖拽过程中的视觉反馈
4. - [ ] 实现 API 交互
   1. - [ ] 在 lib/api/shop-category.ts 中实现更新类别排序 API
   2. - [ ] 在组件中集成 API 调用
   3. - [ ] 实现加载状态和错误处理
5. - [ ] 实现成功/失败提示
   1. - [ ] 在不同操作结果下显示适当的提示
6. - [ ] 实现列表刷新逻辑
   1. - [ ] 排序成功后刷新列表数据
   2. - [ ] 确保列表按照新的排序顺序显示

## Testing Requirements:

- 单元测试覆盖率 >= 85%
- 对排序对话框组件进行组件测试，验证拖拽排序逻辑
- 测试 API 集成是否正确
- 模拟 API 成功和失败的情况，测试错误处理
- 验证排序操作后的状态更新和 UI 变化

## Notes

- 使用 shadcn/ui 的 Dialog 组件实现排序对话框
- 使用@dnd-kit/core, @dnd-kit/sortable, @dnd-kit/modifiers 库实现拖拽功能
- 使用 lucide-react 的 GripVertical 图标作为拖动手柄
- 参考 v0dev 生成的店铺类别排序功能组件设计
- 拖拽排序组件可能需要相对复杂的状态管理和事件处理
