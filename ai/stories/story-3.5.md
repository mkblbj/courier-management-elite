# Story 3.5: 出力数据编辑功能

## Story

**As a** 系统管理员  
**I want** 能够编辑已录入的出力数据  
**so that** 我可以修正错误的录入或更新出力数据的信息。

## Status

not started

## Context

在日常使用过程中，用户可能需要修改已录入的出力数据，如修正数量错误、更新备注信息等。本故事将实现编辑已录入出力数据的功能，允许用户修改现有记录的信息，确保系统中的数据准确和最新。

编辑功能将重用与添加功能相似的表单，但会预填充现有数据，并在提交时执行更新而非创建操作。这样可以保持一致的用户体验，同时提供数据更新的能力。

## Estimation

Story Points: 2

## Acceptance Criteria

1. - [ ] 在"最近录入数据"表格的每一行添加"编辑"按钮
2. - [ ] 点击"编辑"按钮时，弹出编辑出力数据对话框
3. - [ ] 编辑对话框显示所选记录的当前数据，包括：
   - 日期（只读显示，不可编辑）
   - 店铺名称（只读显示，不可编辑）
   - 快递类型（只读显示，不可编辑）
   - 数量（允许编辑，只能输入正整数）
   - 备注（允许编辑，可选字段）
4. - [ ] 实现表单验证逻辑，确保数量为正整数
5. - [ ] 对话框底部有"取消"和"保存"按钮
6. - [ ] 点击"保存"按钮时显示加载状态
7. - [ ] 保存成功后关闭对话框，并更新表格中对应记录的显示
8. - [ ] 保存成功后显示成功提示消息
9. - [ ] 保存失败时显示错误提示消息
10. - [ ] 保存成功后自动更新"当日数据汇总"区域，反映更新后的数据
11. - [ ] 整体视觉设计与系统的其他对话框保持一致

## Subtasks

1. - [ ] 创建编辑对话框组件
   1. - [ ] 在 `app/output-data/components/EditOutputModal.tsx` 中实现编辑对话框组件
   2. - [ ] 复用或扩展现有表单组件，添加预填充功能
   3. - [ ] 实现日期、店铺和快递类型的只读展示
2. - [ ] 实现编辑表单状态管理
   1. - [ ] 使用 React Hook 管理表单状态
   2. - [ ] 实现初始值设置和更新逻辑
   3. - [ ] 实现取消编辑功能
3. - [ ] 实现表单验证
   1. - [ ] 添加数量字段的验证规则
   2. - [ ] 实现错误消息展示
4. - [ ] 实现数据更新功能
   1. - [ ] 创建更新出力数据的 API 接口
   2. - [ ] 实现更新请求处理
   3. - [ ] 处理更新过程中的加载状态
   4. - [ ] 处理更新成功和失败的情况
5. - [ ] 集成到最近录入数据表格
   1. - [ ] 在 `OutputList.tsx` 中添加编辑按钮
   2. - [ ] 实现编辑按钮点击事件处理
   3. - [ ] 打开编辑对话框并传递当前记录数据
6. - [ ] 实现更新后的数据刷新
   1. - [ ] 更新成功后刷新表格中对应记录
   2. - [ ] 更新成功后刷新"当日数据汇总"
7. - [ ] 添加表单反馈机制
   1. - [ ] 添加保存中的加载状态指示器
   2. - [ ] 实现成功和错误提示消息
   3. - [ ] 设置提示消息的自动消失逻辑

## Testing Requirements:

- 单元测试覆盖率 >= 85%
- 对编辑对话框组件进行组件测试，验证渲染和交互逻辑
- 测试表单验证逻辑，包括各种错误情况
- 测试数据更新功能，包括成功和失败情况
- 测试取消编辑功能
- 测试表单预填充功能
- 进行手动测试，验证编辑流程的用户体验

## Notes

- 使用 shadcn/ui 的 Dialog 组件实现编辑对话框
- 使用 shadcn/ui 的 Form 组件和相关控件实现编辑表单
- 使用 zod 库进行表单验证
- 编辑对话框的标题应明确显示"编辑出力数据"
- 只读字段应有明显的视觉区分，使用禁用状态或不同的背景色
- 数量输入框应使用 shadcn/ui 的 Input 组件，并限制只能输入数字
- 备注文本框应使用 shadcn/ui 的 Textarea 组件
- 保存按钮应使用 shadcn/ui 的 Button 组件，采用主色调
- 编辑成功反馈使用 shadcn/ui 的 Toast 组件
- 参考 v0dev 生成的编辑对话框设计
- 按照 UI-draft.md 中 2.2 部分的出力数据编辑设计实现
