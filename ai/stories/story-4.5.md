# Story 4.5: 按快递类型统计功能

## Story

**As a** 系统管理员  
**I want** 能够按快递类型统计出力数据  
**so that** 我可以了解不同快递类型的业务分布，优化资源配置和业务决策。

## Status

Ready for Development

## Context

按快递类型进行统计是出力数据分析的重要维度之一。通过这种方式，管理员可以了解不同快递类型的出力量分布，识别主要的快递渠道和潜力渠道，为运力配置和业务合作提供数据支持。

本故事将实现按快递类型统计的功能，包括数据表格展示和可视化图表，允许用户通过日期范围、店铺类别、具体店铺等筛选条件进一步细化分析。该功能是统计分析功能（Epic 4）的重要组成部分，依赖于统计分析页面基础 UI（故事 4.1）和统计维度选择功能（故事 4.2）。

## Estimation

Story Points: 3

## Acceptance Criteria

1. - [ ] 当用户选择"按快递类型统计"维度时，显示相应的统计数据
2. - [ ] 使用数据表格展示各快递类型的统计结果，包含以下列：
   - 快递类型名称
   - 总出力量
   - 占总体出力的百分比
   - 日均出力量（根据选定时间范围计算）
   - 涉及的店铺数量
   - 同比/环比变化（如果有历史数据）
3. - [ ] 使用图表直观展示各快递类型的数据分布：
   - 提供饼图显示各快递类型的出力量占比
   - 提供柱状图显示各快递类型的出力量大小
   - 提供折线图显示一段时间内各快递类型的出力趋势
   - 图表支持切换不同的显示方式
4. - [ ] 支持以下筛选条件：
   - 日期范围（必选）
   - 店铺类别（可选，多选）
   - 店铺（可选，多选）
5. - [ ] 支持表格数据排序，可以按出力量、占比或日均量排序
6. - [ ] 支持表格分页，当快递类型数量较多时分页显示
7. - [ ] 点击快递类型名称时，可以查看该类型的详细统计信息（如不同店铺对该类型的使用情况）
8. - [ ] 图表支持交互，悬停时显示详细数据
9. - [ ] 当数据量较大时，保持良好的性能和响应速度
10. - [ ] 数据加载过程中显示适当的加载状态

## Subtasks

1. - [ ] 实现数据获取服务
   1. - [ ] 在 `lib/api/stats.ts` 中添加获取按快递类型统计数据的方法
   2. - [ ] 实现日期范围、店铺类别和店铺筛选参数
   3. - [ ] 处理数据加载状态和错误情况
2. - [ ] 实现数据表格组件
   1. - [ ] 创建 `app/stats/components/CourierTypeStatsTable.tsx` 组件
   2. - [ ] 实现表格列配置和数据绑定
   3. - [ ] 添加排序功能
   4. - [ ] 实现分页控件
   5. - [ ] 添加快递类型名称点击交互
3. - [ ] 实现数据可视化图表
   1. - [ ] 创建 `app/stats/components/CourierTypeStatsChart.tsx` 组件
   2. - [ ] 集成 Recharts 或其他图表库
   3. - [ ] 实现饼图、柱状图和折线图
   4. - [ ] 添加图表切换功能
   5. - [ ] 实现图表交互和工具提示
4. - [ ] 实现快递类型详情视图
   1. - [ ] 创建 `app/stats/components/CourierTypeDetailModal.tsx` 组件
   2. - [ ] 实现详情数据获取和展示
   3. - [ ] 添加详情图表和表格
5. - [ ] 完善筛选器组件
   1. - [ ] 更新 `StatsFilterPanel.tsx` 组件以支持快递类型统计所需的筛选条件
   2. - [ ] 实现日期范围选择器
   3. - [ ] 实现店铺类别多选框
   4. - [ ] 实现店铺多选框
   5. - [ ] 添加筛选条件重置功能
6. - [ ] 集成到统计分析页面
   1. - [ ] 在 `ShopOutputStats.tsx` 中条件性渲染快递类型统计组件
   2. - [ ] 连接维度选择、筛选器和数据展示组件
   3. - [ ] 优化页面布局和交互流程
7. - [ ] 性能优化
   1. - [ ] 实现数据缓存机制
   2. - [ ] 优化大数据量下的渲染性能
   3. - [ ] 添加数据预取功能

## Testing Requirements:

- 单元测试覆盖率 >= 85%
- 对数据表格和图表组件进行组件测试，验证渲染和交互逻辑
- 测试筛选功能，验证筛选条件对数据结果的影响
- 测试排序和分页功能
- 测试快递类型详情查看功能
- 测试大数据量下的性能和响应速度
- 测试与 API 的集成，包括不同参数组合的情况
- 进行端到端测试，验证整个功能流程

## Notes

- 使用 shadcn/ui 的 Table 组件实现数据表格
- 使用 Recharts 实现数据可视化图表
- 使用 shadcn/ui 的 Dialog 组件实现快递类型详情模态框
- 图表颜色应采用一致的配色方案，提高可读性和美观度
- 折线图应显示时间趋势，考虑添加移动平均线以平滑短期波动
- 百分比数据应精确到小数点后两位
- 考虑添加同比/环比变化的箭头指示（上升/下降）和颜色提示（绿/红）
- 确保表格和图表在打印时能够正确显示（添加打印样式）
- 参考现有的统计分析页面样式，确保视觉一致性
