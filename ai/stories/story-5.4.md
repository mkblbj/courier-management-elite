# Story 5.4: 仪表盘出力趋势图

## Story

**As a** 系统管理员  
**I want** 在仪表盘上看到最近一段时间店铺出力的趋势变化  
**so that** 我可以了解业务波动情况，及时发现问题并做出决策。

## Status

待实现

## Context

仪表盘已经实现了今日和明日的出力数据展示，但缺乏历史数据的趋势展示。通过添加出力趋势图，用户可以直观地看到最近 7 天的出力变化情况，便于分析业务波动规律和发现异常情况。

趋势图将支持按店铺类别、店铺或快递类型查看，提供多维度的数据分析视角，帮助用户全面了解业务运行情况。

## Estimation

Story Points: 3

## Acceptance Criteria

1. - [ ] 在/dashboard 页面的出力数据标签页添加"出力趋势图"卡片
2. - [ ] 趋势图默认显示最近 7 天的出力数据变化
3. - [ ] 支持按店铺类别查看趋势，显示各类别的数据线
4. - [ ] 支持按店铺查看趋势，可选择特定店铺查看其数据变化
5. - [ ] 支持按快递类型查看趋势，显示各快递类型的数据线
6. - [ ] 提供维度切换按钮，方便用户在不同维度间切换
7. - [ ] 图表支持鼠标悬停查看某日详细数据
8. - [ ] 实现自动刷新机制，定期更新数据（默认 5 分钟刷新一次）
9. - [ ] 添加手动刷新按钮，点击后立即更新数据
10. - [ ] 数据加载过程中显示加载状态
11. - [ ] 当没有数据时，显示"暂无数据"提示
12. - [ ] 卡片的视觉设计应与系统的整体风格保持一致

## Subtasks

1. - [ ] 创建出力趋势图卡片组件
   1. - [ ] 在 `app/dashboard/components/ShopOutputTrendCard.tsx` 中实现趋势图卡片组件
   2. - [ ] 实现折线图组件，集成 Recharts 库
   3. - [ ] 添加维度切换组件，支持类别、店铺、快递类型切换
2. - [ ] 实现数据获取和处理
   1. - [ ] 创建获取历史出力数据的服务函数
   2. - [ ] 实现数据加载和错误处理
   3. - [ ] 实现数据按日期和选择维度的分组处理
3. - [ ] 实现趋势图可视化
   1. - [ ] 集成 Recharts 库的折线图组件
   2. - [ ] 实现 X 轴（日期）和 Y 轴（出力量）的配置
   3. - [ ] 为不同维度的数据线设置不同颜色
   4. - [ ] 实现数据点悬停显示详情功能
4. - [ ] 实现维度切换功能
   1. - [ ] 创建维度切换按钮组
   2. - [ ] 实现维度切换逻辑，切换时重新加载相应数据
   3. - [ ] 根据所选维度调整图表显示
5. - [ ] 实现店铺或类别选择功能
   1. - [ ] 添加店铺类别下拉选择器
   2. - [ ] 添加店铺下拉选择器（当维度为"按店铺"时显示）
   3. - [ ] 添加快递类型下拉选择器（当维度为"按快递类型"时显示）
6. - [ ] 实现自动刷新机制
   1. - [ ] 创建定时器，定期刷新数据
   2. - [ ] 添加手动刷新按钮
   3. - [ ] 确保组件卸载时清除定时器
7. - [ ] 集成到仪表盘页面
   1. - [ ] 将卡片组件集成到仪表盘布局，放置在适当位置
   2. - [ ] 调整卡片尺寸和位置
   3. - [ ] 确保与其他仪表盘组件的视觉协调性
8. - [ ] 实现响应式布局
   1. - [ ] 优化卡片在不同屏幕尺寸下的显示
   2. - [ ] 确保图表在小屏幕上仍能清晰显示
   3. - [ ] 测试不同设备下的展示效果

## Testing Requirements:

- 单元测试覆盖率 >= 85%
- 对卡片组件进行组件测试，验证渲染和数据展示
- 测试数据处理逻辑的准确性
- 测试维度切换功能
- 测试趋势图的渲染和交互
- 测试选择器组件的功能
- 测试自动刷新和手动刷新功能
- 测试组件在不同数据状态下的显示（空数据、加载中、错误等）
- 进行手动测试，验证在不同屏幕尺寸下的用户体验

## Notes

- 使用 shadcn/ui 的 Card 组件实现趋势图卡片
- 使用 Recharts 库实现折线图
- 图表要有图例，清晰显示各数据线代表的类别/店铺/快递类型
- X 轴显示日期，考虑使用简化格式如"6/1"而非完整日期，节省空间
- Y 轴显示出力量，考虑根据数据范围自动调整刻度
- 维度切换按钮使用 ToggleGroup 组件实现，横向排列
- 数据选择下拉框使用 Select 组件实现
- 确保数据刷新时有适当的视觉反馈，但不要打断用户操作
- 考虑添加时间范围选择功能，允许用户查看除默认 7 天外的其他时间跨度
- 在 API 调用中使用适当的缓存机制，避免频繁请求
- 趋势图的颜色方案应与系统现有配色一致，确保视觉统一性
