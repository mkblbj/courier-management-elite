# 店铺出力管理功能 - 产品积压清单

## 变更日志

| 变更     | 日期       | 描述             | 作者 |
| -------- | ---------- | ---------------- | ---- |
| 初始版本 | 2023-05-18 | PO 审核后版本    | AI   |
| 审核版本 | 2023-05-18 | 我 审核后版本    | ME   |
| 更新版本 | 2023-06-01 | 增加店铺分类功能 | AI   |

## 产品积压概览

以下是店铺出力管理功能的产品积压清单，按照实现的逻辑顺序排列。每个 Epic 包含多个用户故事，用户故事按照实现优先级和依赖关系排序。

## Epic 0: 初始设置

该 Epic 包含项目启动所需的基础设施和配置工作。

### 故事 0.1: 数据库迁移与设计

**描述**: 创建所需的数据库表，包括 shop_categories 表、shops 表和 shop_outputs 表，并设计必要的索引和外键约束。

**验收标准**:

- 创建 shop_categories 表，包含 id、name、sort_order、created_at、updated_at 字段
- 创建 shops 表，包含 id、name、category_id、is_active、sort_order、remark、created_at、updated_at 字段
- 创建 shop_outputs 表，包含 id、shop_id、courier_id、output_date、quantity、notes、created_at、updated_at 字段
- 创建必要的索引，包括 shop_outputs 表上的日期索引、shop_id 索引、courier_id 索引和复合索引
- 设置外键约束，将 shops 表的 category_id 关联到 shop_categories 表的 id
- 设置外键约束，将 shop_outputs 表的 shop_id 关联到 shops 表的 id，courier_id 关联到 couriers 表的 id

### 故事 0.2: API 路由与控制器设置

**描述**: 配置必要的 API 路由和控制器框架，为后续功能实现做准备。

**验收标准**:

- 创建 shop-categories 相关的 API 路由
- 创建 shops 相关的 API 路由
- 创建 shop-outputs 相关的 API 路由
- 创建统计分析相关的 API 路由
- 创建仪表盘相关的 API 路由
- 设置基本的控制器框架

### 故事 0.3: 前端路由与基础组件设置

**描述**: 配置前端路由和基础组件，为后续 UI 开发做准备。

**验收标准**:

- 在现有前端项目中添加 shop-categories 和 shop-outputs 相关路由
- 创建必要的基础组件目录结构
- 配置与服务器 API 通信的基础设置

## Epic 1: 店铺类别管理功能

该 Epic 包含对店铺类别进行管理的所有功能，是店铺管理的基础部分。

### 故事 1.1: 店铺类别列表展示

**描述**: 在现有的/courier-types 页面中添加店铺类别标签页，实现类别列表的展示功能。

**验收标准**:

- 在/courier-types 页面添加标签切换功能，支持在快递类型、店铺管理之间切换，店铺类别放在店铺管理页面下。
- 店铺类别列表展示类别名称和排序信息
- 支持按名称或创建时间排序
- 支持搜索功能

### 故事 1.2: 店铺类别添加功能

**描述**: 实现添加新店铺类别的功能。

**验收标准**:

- 创建"添加类别"按钮和对话框
- 对话框包含类别名称字段
- 实现表单验证逻辑
- 提交后将新类别添加到列表中
- 显示成功/失败消息

### 故事 1.3: 店铺类别编辑功能

**描述**: 实现编辑现有店铺类别信息的功能。

**验收标准**:

- 在类别列表中添加"编辑"按钮
- 创建编辑对话框，预填充现有类别信息
- 实现表单验证逻辑
- 提交后更新类别信息
- 显示成功/失败消息

### 故事 1.4: 店铺类别删除功能

**描述**: 实现删除店铺类别的功能。

**验收标准**:

- 在类别列表中添加"删除"按钮
- 创建删除确认对话框
- 实现删除逻辑，包括检查是否有店铺关联到该类别
- 删除后从列表中移除该类别
- 显示成功/失败消息

### 故事 1.5: 店铺类别排序功能

**描述**: 实现调整店铺类别排序顺序的功能。

**验收标准**:

- 创建"调整排序"按钮和对话框
- 实现拖拽排序功能
- 保存排序后更新列表中的显示顺序
- 显示成功/失败消息

## Epic 2: 店铺管理功能

该 Epic 包含对店铺信息进行管理的所有功能。

### 故事 2.1: 店铺列表展示

**描述**: 在现有的/courier-types 页面中添加店铺管理标签页，实现店铺列表的展示功能。

**验收标准**:

- 在/courier-types 页面添加标签切换功能，支持在快递类型、店铺类别和店铺管理之间切换
- 店铺列表展示店铺名称、所属类别、状态和排序信息
- 支持按名称、类别或创建时间排序
- 支持按类别筛选功能
- 支持搜索功能

### 故事 2.2: 店铺添加功能

**描述**: 实现添加新店铺的功能。

**验收标准**:

- 创建"添加店铺"按钮和对话框
- 对话框包含店铺名称、类别选择、备注和状态字段
- 实现表单验证逻辑
- 提交后将新店铺添加到列表中
- 显示成功/失败消息

### 故事 2.3: 店铺编辑功能

**描述**: 实现编辑现有店铺信息的功能。

**验收标准**:

- 在店铺列表中添加"编辑"按钮
- 创建编辑对话框，预填充现有店铺信息
- 实现表单验证逻辑
- 提交后更新店铺信息
- 显示成功/失败消息

### 故事 2.4: 店铺删除功能

**描述**: 实现删除店铺的功能。

**验收标准**:

- 在店铺列表中添加"删除"按钮
- 创建删除确认对话框
- 实现删除逻辑
- 删除后从列表中移除该店铺
- 显示成功/失败消息

### 故事 2.5: 店铺状态切换功能

**描述**: 实现启用/禁用店铺的功能。

**验收标准**:

- 在店铺列表中添加状态切换开关
- 实现状态切换逻辑
- 状态变更后更新列表中的显示
- 显示成功/失败消息

### 故事 2.6: 店铺排序功能

**描述**: 实现调整店铺排序顺序的功能。

**验收标准**:

- 创建"调整排序"按钮和对话框
- 实现拖拽排序功能
- 支持按类别分组排序
- 保存排序后更新列表中的显示顺序
- 显示成功/失败消息

## Epic 3: 出力数据管理功能

该 Epic 包含记录和管理店铺出力数据的所有功能，是系统的核心部分。

### 故事 3.1: 出力数据页面基础 UI

**描述**: 创建出力数据管理页面，实现基本的 UI 布局。

**验收标准**:

- 创建/output-data 路由和页面
- 实现页面基本布局，包括日期选择器、表单区域和数据展示区域
- 页面风格与现有系统一致

### 故事 3.2: 日期与店铺选择组件

**描述**: 实现日期选择器和店铺选择组件。

**验收标准**:

- 创建日期选择器，支持选择当前日期或未来日期
- 添加"今天"和"明天"快捷按钮
- 创建店铺类别下拉选择框，支持按类别筛选店铺
- 创建店铺下拉选择框，显示所有启用状态的店铺
- 创建快递类型下拉选择框，显示所有启用状态的快递类型

### 故事 3.3: 出力数据录入表单

**描述**: 实现出力数据录入表单及其验证逻辑。

**验收标准**:

- 创建包含日期、店铺、快递类型、数量和备注字段的表单
- 实现表单验证逻辑
- 创建添加按钮和提交逻辑
- 提交成功后清空表单，准备下一次录入
- 显示成功/失败消息

### 故事 3.4: 最近录入数据展示

**描述**: 实现最近录入的出力数据展示功能。

**验收标准**:

- 创建最近录入数据表格组件
- 显示日期、店铺、店铺类别、快递类型、数量等信息
- 添加编辑和删除按钮
- 实现数据刷新机制，添加新记录后自动更新
- 支持简单的筛选功能

### 故事 3.5: 出力数据编辑功能

**描述**: 实现编辑已录入出力数据的功能。

**验收标准**:

- 点击编辑按钮打开编辑对话框
- 预填充现有数据
- 实现表单验证逻辑
- 提交后更新记录
- 显示成功/失败消息

### 故事 3.6: 出力数据删除功能

**描述**: 实现删除出力数据记录的功能。

**验收标准**:

- 点击删除按钮显示确认对话框
- 实现删除逻辑
- 删除后从列表中移除该记录
- 显示成功/失败消息

### 故事 3.7: 当日数据汇总展示

**描述**: 实现当日出力数据的汇总展示功能。

**验收标准**:

- 创建当日数据汇总表格组件
- 按店铺类别、店铺和快递类型分组显示汇总数据
- 显示各组合的出力数量和占比
- 实现自动刷新机制，数据变更后更新显示

### 故事 3.8: 高级筛选面板

**描述**: 实现高级筛选功能，支持多条件组合查询。

**验收标准**:

- 创建筛选面板组件
- 支持日期范围选择
- 支持店铺类别筛选
- 支持多选店铺筛选
- 支持多选快递类型筛选
- 实现筛选逻辑，根据条件显示过滤后的数据
- 筛选后可根据筛选的条件算出总数

## Epic 4: 统计分析功能

该 Epic 包含对出力数据进行统计分析的所有功能。

### 故事 4.1: 统计分析页面基础 UI

**描述**: 在现有的/stats 页面添加出力统计选项卡，实现基本 UI 布局。

**验收标准**:

- 在/stats 页面添加"出力统计"选项卡
- 实现基本布局，包括统计控制面板和数据展示区域
- 页面风格与现有系统一致

### 故事 4.2: 统计维度选择功能

**描述**: 实现统计维度选择功能，支持按店铺类别、按店铺、按快递类型、按日期进行统计。

**验收标准**:

- 创建统计维度选择按钮组
- 支持选择统计维度（店铺类别、店铺、快递类型、日期）
- 实现维度切换逻辑，切换后重新加载数据

### 故事 4.3: 按店铺类别统计功能

**描述**: 实现按店铺类别统计出力数据的功能。

**验收标准**:

- 创建按店铺类别统计的数据表格
- 显示各类别的总出力量、占比、日均量等指标
- 创建按店铺类别统计的图表（柱状图或饼图）
- 支持日期范围和快递类型筛选

### 故事 4.4: 按店铺统计功能

**描述**: 实现按店铺统计出力数据的功能。

**验收标准**:

- 创建按店铺统计的数据表格
- 显示各店铺的总出力量、占比、日均量等指标
- 创建按店铺统计的图表（柱状图或饼图）
- 支持日期范围、店铺类别和快递类型筛选

### 故事 4.5: 按快递类型统计功能

**描述**: 实现按快递类型统计出力数据的功能。

**验收标准**:

- 创建按快递类型统计的数据表格
- 显示各快递类型的总出力量、占比、日均量等指标
- 创建按快递类型统计的图表（柱状图或饼图）
- 支持日期范围、店铺类别和店铺筛选

### 故事 4.6: 按日期统计功能

**描述**: 实现按日期统计出力数据的功能。

**验收标准**:

- 创建按日期统计的数据表格
- 显示各日期的总出力量和分布情况
- 创建按日期统计的图表（折线图或柱状图）
- 支持店铺类别、店铺和快递类型筛选

### 故事 4.7: 数据导出功能

**描述**: 实现统计数据导出功能。

**验收标准**:

- 添加数据导出按钮
- 支持将当前统计结果导出为 CSV 或 Excel 格式
- 导出文件包含所有相关数据和统计指标
- 显示导出成功/失败消息

## Epic 5: 仪表盘集成

该 Epic 包含将出力数据集成到系统仪表盘的所有功能。

### 故事 5.1: 今日出力卡片

**描述**: 在/dashboard 页面添加"今日店铺出力情况"卡片。

**验收标准**:

- 创建今日出力卡片组件
- 显示今日总出力量
- 显示各店铺类别出力分布的饼图
- 显示各店铺出力分布的饼图，支持按类别筛选
- 显示各店铺出力量和占比的表格，按类别分组
- 实现自动刷新机制

### 故事 5.2: 明日出力预测卡片

**描述**: 在/dashboard 页面添加"明日店铺出力预测"卡片。

**验收标准**:

- 创建明日出力预测卡片组件
- 显示明日预计总出力量
- 显示各店铺类别预计出力分布的饼图
- 显示各店铺预计出力分布的饼图，支持按类别筛选
- 显示各店铺预计出力量和占比的表格，按类别分组
- 实现自动刷新机制

### 故事 5.3: 仪表盘数据 API 集成

**描述**: 实现仪表盘所需的数据 API。

**验收标准**:

- 开发获取今日店铺出力数据的 API，支持按类别分组
- 开发获取明日店铺出力预测的 API，支持按类别分组
- 确保 API 性能满足实时刷新需求
- 测试 API 在高负载情况下的响应时间

### 故事 5.4: 仪表盘出力趋势图

**描述**: 添加出力数据趋势图，展示近期出力变化情况。

**验收标准**:

- 创建出力趋势图组件
- 显示最近 7 天的出力数据变化
- 支持按店铺类别、店铺或快递类型查看趋势
- 实现自动刷新机制

## 优先级和依赖关系

以下是各 Epic 和故事之间的主要依赖关系：

1. Epic 0（初始设置）是所有其他 Epic 的前置条件
2. Epic 1（店铺类别管理功能）必须在 Epic 2（店铺管理功能）之前完成，因为店铺需要关联到类别
3. Epic 2（店铺管理功能）必须在 Epic 3（出力数据管理功能）之前完成，因为出力数据需要关联到店铺
4. Epic 3（出力数据管理功能）必须在 Epic 4（统计分析功能）和 Epic 5（仪表盘集成）之前完成，因为这些功能依赖于出力数据

各 Epic 内部的故事也按照依赖关系和实现逻辑排序，应按照列出的顺序实现。

## 开发顺序建议

建议按照以下顺序进行开发：

1. 完成 Epic 0 的所有故事
2. 完成 Epic 1 的所有故事
3. 完成 Epic 2 的所有故事
4. 完成 Epic 3 的故事 3.1 到 3.7
5. 完成 Epic 5 的故事 5.1 和 5.3
6. 完成 Epic 3 的故事 3.8
7. 完成 Epic 4 的所有故事
8. 完成 Epic 5 的剩余故事

这个顺序确保了最核心的功能（店铺类别管理、店铺管理和出力数据管理）优先实现，同时也让部分高价值的仪表盘功能能够较早地交付给用户。
