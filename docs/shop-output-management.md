# 店铺出力管理功能 PRD

## 状态: Draft

## 简介

本文档描述了为快递管理系统增加的新功能 - 店铺出力管理功能。该功能旨在帮助电商卖家记录并追踪各店铺每日的订单出力情况，包括今天和未来日期的预计出力量。通过这一功能，用户可以更好地掌握各个网店的发货量，合理安排物流资源，提高运营效率。

## 目标与背景

### 背景

随着业务发展，用户需要在现有的快递发货数据管理基础上，增加对不同店铺出力数据的管理功能。用户希望系统能够记录各个店铺每天的出货量情况，并提供相应的统计和分析功能。

### 项目目标

- 添加店铺管理功能，支持店铺信息的增删改查
- 增加出力数据记录功能，允许用户记录今天和未来日期的店铺出力情况
- 提供出力数据的统计分析功能
- 在仪表盘上展示今日店铺出力实时统计

### 成功标准

- 用户能够轻松管理店铺信息，包括添加、编辑和删除店铺
- 用户能够方便地记录各店铺的出力数据，包括今天和未来日期
- 系统能够提供清晰的出力数据统计分析，辅助决策
- 仪表盘能够展示实时的店铺出力情况

## 功能与需求

### 功能需求

#### 1. 店铺管理

- **店铺信息 CRUD**

  - 创建店铺: 用户可以添加新的店铺，包括店铺名称、备注等信息
  - 查看店铺: 以列表形式展示所有店铺，支持排序和搜索
  - 更新店铺: 修改店铺名称、备注等信息
  - 删除店铺: 删除不再需要的店铺信息

- **店铺状态管理**
  - 启用/停用店铺: 用户可以切换店铺的活跃状态
  - 排序管理: 用户可以调整店铺的显示顺序

#### 2. 出力数据管理

- **出力数据记录**
  - 添加出力记录: 记录指定日期（今天或未来日期）特定店铺特定快递类型的出力数量
  - 查看出力记录: 以列表形式展示出力记录，支持按日期、店铺、快递类型等筛选
  - 更新出力记录: 修改已录入的出力数据
  - 删除出力记录: 删除错误的出力记录
- **出力数据展示**
  - 最近录入数据: 展示最近添加的出力记录，类似现有的发货数据页面
  - 当日出力汇总: 展示今日各店铺各快递类型的出力总量

#### 3. 统计分析

- **出力数据统计**

  - 按店铺统计: 各店铺的出力数据统计
  - 按快递类型统计: 各快递类型的出力数据统计
  - 按日期统计: 不同日期的出力数据统计
  - 综合统计: 店铺、快递类型、日期多维度统计

- **可视化展示**
  - 图表展示: 使用柱状图、折线图等展示出力数据趋势
  - 数据透视: 多维度数据对比分析

#### 4. 仪表盘集成

- **今日出力概览**

  - 今日出力总量卡片: 展示今日所有店铺出力总量
  - 店铺出力分布卡片: 展示各店铺的出力占比

- **明日出力预览**
  - 明日出力总量卡片: 展示明日所有店铺预计出力总量
  - 店铺明日出力分布: 展示各店铺明日预计出力占比

### 非功能需求

- **性能要求**

  - 页面加载时间: 出力数据页面加载时间不超过 2 秒
  - 数据处理能力: 系统能够处理大量出力记录数据

- **兼容性要求**

  - 与现有系统兼容: 新功能与现有的快递类型管理和发货数据管理功能无冲突
  - 前端兼容性: 与现有前端技术栈和 UI 设计风格一致

- **可用性要求**

  - 易用性: 操作流程简单直观，用户无需复杂培训即可上手
  - 响应式设计: 支持在不同设备上使用

- **安全要求**
  - 数据验证: 所有用户输入都经过验证，防止无效数据
  - 错误处理: 提供友好的错误提示

## UI 设计与用户交互

### 1. 店铺管理界面设计

#### 1.1 店铺管理标签页

店铺管理功能将集成到现有的`/courier-types`页面中，通过标签页方式切换：

```
+----------------------------------------+
|  快递类型  |  店铺管理  |               |
+----------------------------------------+
|                                        |
|  店铺列表                               |
|  +-----------------------------+       |
|  | 店铺名称 | 状态 | 排序 | 操作 |       |
|  +-----------------------------+       |
|  | 淘宝店   | 启用 |  1   | ... |       |
|  | 京东店   | 启用 |  2   | ... |       |
|  | 拼多多店 | 禁用 |  3   | ... |       |
|  +-----------------------------+       |
|                                        |
+----------------------------------------+
```

#### 1.2 添加/编辑店铺对话框

```
+----------------------------------------+
|  添加店铺                   [X]         |
+----------------------------------------+
|                                        |
|  店铺名称:  [                    ]     |
|                                        |
|  备注:      [                    ]     |
|                                        |
|  状态:      [启用] [禁用]              |
|                                        |
|                                        |
|  [取消]                 [确认]          |
|                                        |
+----------------------------------------+
```

#### 1.3 店铺排序功能

支持拖拽排序，类似现有的快递类型排序方式。

```
+----------------------------------------+
|  调整店铺排序                 [X]       |
+----------------------------------------+
|                                        |
|  [ ≡ ] 淘宝店                          |
|  [ ≡ ] 京东店                          |
|  [ ≡ ] 拼多多店                        |
|  [ ≡ ] 小红书店                        |
|                                        |
|  [取消]                 [保存排序]      |
|                                        |
+----------------------------------------+
```

### 2. 出力数据管理界面设计

#### 2.1 出力数据页面布局

```
+----------------------------------------+
|  出力数据                               |
+----------------------------------------+
|                                        |
|  日期: [2025-05-05] [今天] [明天]       |
|                                        |
|  店铺: [选择店铺▼]  快递: [选择快递▼]   |
|                                        |
|  数量: [      ]     备注: [        ]   |
|                                        |
|  [添加记录]                             |
|                                        |
|  最近录入数据:                          |
|  +--------------------------------+    |
|  | 日期 | 店铺 | 快递 | 数量 | 操作 |    |
|  +--------------------------------+    |
|  | ... | ... | ... | ... | ... |      |
|  +--------------------------------+    |
|                                        |
|  当日数据汇总:                          |
|  +----------------------------+        |
|  | 店铺 | 快递 | 数量 |               |
|  +----------------------------+        |
|  | ... | ... | ... |                 |
|  +----------------------------+        |
|                                        |
+----------------------------------------+
```

#### 2.2 筛选和搜索面板

```
+----------------------------------------+
|  筛选条件                               |
+----------------------------------------+
|                                        |
|  日期范围: [起始日期] 至 [结束日期]      |
|                                        |
|  店铺: [多选下拉框]                     |
|                                        |
|  快递类型: [多选下拉框]                  |
|                                        |
|  [重置]           [应用筛选]            |
|                                        |
+----------------------------------------+
```

### 3. 统计分析界面设计

#### 3.1 统计选项卡

在现有的`/stats`页面添加"出力统计"选项卡：

```
+----------------------------------------+
|  发货统计  |  出力统计  |                |
+----------------------------------------+
|                                        |
|  统计维度:                              |
|  [按店铺] [按快递类型] [按日期]          |
|                                        |
|  日期范围: [起始日期] 至 [结束日期]      |
|                                        |
|  [生成统计]                             |
|                                        |
+----------------------------------------+
```

#### 3.2 统计图表区域

```
+----------------------------------------+
|  数据图表                               |
+----------------------------------------+
|                                        |
|  [图表显示区域 - 柱状图/折线图]          |
|                                        |
+----------------------------------------+
|                                        |
|  数据表格                               |
|  +--------------------------------+    |
|  | 店铺名称 | 总量 | 占比 | 日均量 |    |
|  +--------------------------------+    |
|  | 淘宝店   | 125 | 45% | 25   |      |
|  | 京东店   | 87  | 32% | 17   |      |
|  | 拼多多店 | 63  | 23% | 12   |      |
|  +--------------------------------+    |
|                                        |
+----------------------------------------+
```

### 4. 仪表盘集成设计

#### 4.1 今日店铺出力卡片

在`/dashboard`页面添加新的卡片组件：

```
+----------------------------------------+
|  今日店铺出力情况                        |
+----------------------------------------+
|                                        |
|  总出力量: 285                          |
|                                        |
|  [店铺出力分布饼图]                      |
|                                        |
|  +----------------------------+        |
|  | 店铺名称 | 出力量 | 占比 |          |
|  +----------------------------+        |
|  | 淘宝店   | 125    | 44% |          |
|  | 京东店   | 95     | 33% |          |
|  | 拼多多店 | 65     | 23% |          |
|  +----------------------------+        |
|                                        |
+----------------------------------------+
```

#### 4.2 明日店铺出力卡片

```
+----------------------------------------+
|  明日店铺出力预测                        |
+----------------------------------------+
|                                        |
|  预计总出力量: 320                      |
|                                        |
|  [店铺预计出力分布饼图]                  |
|                                        |
|  +----------------------------+        |
|  | 店铺名称 | 预计出力 | 占比 |        |
|  +----------------------------+        |
|  | 淘宝店   | 150    | 47% |          |
|  | 京东店   | 100    | 31% |          |
|  | 拼多多店 | 70     | 22% |          |
|  +----------------------------+        |
|                                        |
+----------------------------------------+
```

## Epic 故事列表

### Epic 0: 初始设置

- 数据库迁移: 创建 shops 和 shop_outputs 表
- 配置路由: 添加必要的 API 路由和前端路由

### Epic 1: 店铺管理功能

#### 故事 1: 店铺页面 UI

要求:

- 在现有`/courier-types`页面添加标签切换功能，支持在快递类型和店铺管理之间切换
- 设计店铺列表 UI，包括店铺名称、创建时间、状态等信息的展示
- 实现店铺排序功能

#### 故事 2: 店铺 CRUD 操作

要求:

- 实现添加店铺的 UI 和功能
- 实现编辑店铺的 UI 和功能
- 实现删除店铺的确认和功能
- 实现店铺启用/停用的切换功能

#### 故事 3: 店铺管理 API

要求:

- 创建店铺模型和数据库交互
- 实现获取店铺列表的 API
- 实现添加、更新、删除店铺的 API
- 实现修改店铺状态和排序的 API

### Epic 2: 出力数据管理功能

#### 故事 1: 出力数据页面 UI

要求:

- 创建`/output-data`页面，设计与现有`/shipping-data`页面风格一致的界面
- 实现日期选择器，支持选择当前日期或未来日期
- 实现店铺选择和快递类型选择的下拉框
- 实现出力数量的输入框和备注字段

#### 故事 2: 出力数据录入功能

要求:

- 实现添加出力记录的表单验证和提交功能
- 实现出力记录的编辑功能
- 实现出力记录的删除功能
- 实现最近录入数据的展示区域

#### 故事 3: 出力数据 API

要求:

- 创建出力数据模型和数据库交互
- 实现获取出力数据的 API，支持按日期、店铺、快递类型筛选
- 实现添加、更新、删除出力记录的 API
- 实现获取最近录入数据的 API

### Epic 3: 统计分析功能

#### 故事 1: 出力数据统计

要求:

- 在`/stats`页面添加出力数据统计选项
- 实现按店铺统计的数据表格和图表
- 实现按快递类型统计的数据表格和图表
- 实现按日期统计的数据表格和图表

#### 故事 2: 统计 API

要求:

- 实现获取按店铺统计数据的 API
- 实现获取按快递类型统计数据的 API
- 实现获取按日期统计数据的 API
- 实现获取综合统计数据的 API

### Epic 4: 仪表盘集成

#### 故事 1: 仪表盘出力卡片

要求:

- 在`/dashboard`页面添加"今日店铺出力情况"卡片
- 实现店铺出力数据的实时统计展示
- 与现有的"今日各快递类型实时发货量"卡片风格保持一致

#### 故事 2: 明日出力预测卡片

要求:

- 在`/dashboard`页面添加"明日店铺出力预测"卡片
- 实现店铺明日预计出力数据的统计展示
- 与今日出力卡片风格保持一致
- 支持明日数据的实时更新

#### 故事 3: 仪表盘 API 扩展

要求:

- 扩展仪表盘数据 API，加入店铺出力数据
- 实现获取今日店铺出力数据的 API
- 实现获取明日店铺出力预测的 API

## 技术栈

遵循现有项目的技术栈:

| 技术         | 版本      | 描述                             |
| ------------ | --------- | -------------------------------- |
| Node.js      | >= 22.2.0 | JavaScript 运行时                |
| Express      | 4.18.2    | Web 应用框架                     |
| MySQL        | >= 8.4.0  | 关系型数据库                     |
| React        | >= 19.0.0 | 前端用户界面库                   |
| Next.js      | 15.2.4    | React 框架，用于服务端渲染和路由 |
| TypeScript   | >= 5.0.0  | 静态类型检查                     |
| Tailwind CSS | 3.4.17    | 实用优先的 CSS 框架              |
| Shadcn UI    | -         | 基于 Radix 的组件系统            |
| Recharts     | 2.15.0    | 图表库                           |

## 项目结构

### 后端结构

```
backend/
├── src/
│   ├── controllers/
│   │   ├── shopController.js         # 店铺控制器
│   │   └── shopOutputController.js   # 店铺出力数据控制器
│   ├── models/
│   │   ├── Shop.js                   # 店铺模型
│   │   └── ShopOutput.js             # 店铺出力数据模型
│   ├── routes/
│   │   ├── shopRoutes.js             # 店铺路由
│   │   └── shopOutputRoutes.js       # 店铺出力数据路由
│   └── db/
│       ├── migrations/
│       │   ├── create_shops_table.js         # 创建店铺表
│       │   └── create_shop_outputs_table.js  # 创建店铺出力数据表
```

### 前端结构

```
frontend/
├── app/
│   ├── output-data/
│   │   ├── page.tsx                  # 出力数据页面
│   │   └── components/               # 出力数据组件
│   ├── courier-types/
│   │   ├── ShopTab.tsx               # 店铺管理标签页
│   │   └── components/               # 店铺管理组件
│   ├── stats/
│   │   ├── ShopOutputStats.tsx       # 出力数据统计组件
│   │   └── components/               # 统计相关组件
│   └── dashboard/
│       └── components/
│           └── ShopOutputCard.tsx    # 店铺出力卡片
├── components/
│   ├── shop/                         # 店铺相关组件
│   └── shop-output/                  # 出力数据相关组件
└── services/
    ├── shopService.ts                # 店铺服务
    └── shopOutputService.ts          # 出力数据服务
```

### 数据库结构

#### 店铺表 (shops)

| 字段名     | 类型         | 描述                |
| ---------- | ------------ | ------------------- |
| id         | INT          | 主键，自增          |
| name       | VARCHAR(255) | 店铺名称            |
| is_active  | BOOLEAN      | 是否启用，默认 true |
| sort_order | INT          | 排序顺序，默认 0    |
| remark     | TEXT         | 备注信息，可为 null |
| created_at | TIMESTAMP    | 创建时间            |
| updated_at | TIMESTAMP    | 更新时间            |

#### 店铺出力数据表 (shop_outputs)

| 字段名      | 类型      | 描述                   |
| ----------- | --------- | ---------------------- |
| id          | INT       | 主键，自增             |
| shop_id     | INT       | 外键，关联 shops 表    |
| courier_id  | INT       | 外键，关联 couriers 表 |
| output_date | DATE      | 出力日期               |
| quantity    | INT       | 出力数量               |
| notes       | TEXT      | 备注信息，可为 null    |
| created_at  | TIMESTAMP | 创建时间               |
| updated_at  | TIMESTAMP | 更新时间               |

## 实现细节

### 1. API 接口设计

#### 1.1 店铺管理 API

| 接口路径              | 方法   | 描述             | 请求参数                               | 响应结果                        |
| --------------------- | ------ | ---------------- | -------------------------------------- | ------------------------------- |
| /api/shops            | GET    | 获取店铺列表     | ?is_active=true&search=xx&sort_by=name | { success, data: [shop1, ...] } |
| /api/shops/:id        | GET    | 获取单个店铺     | id                                     | { success, data: shop }         |
| /api/shops            | POST   | 创建店铺         | { name, remark, is_active }            | { success, data: { id, ... } }  |
| /api/shops/:id        | PUT    | 更新店铺         | { name, remark, is_active }            | { success, data: shop }         |
| /api/shops/:id        | DELETE | 删除店铺         | id                                     | { success, message }            |
| /api/shops/sort       | POST   | 更新店铺排序     | [{ id, sort_order }, ...]              | { success, message }            |
| /api/shops/:id/toggle | POST   | 切换店铺活跃状态 | id                                     | { success, data: shop }         |

#### 1.2 店铺出力数据 API

| 接口路径                 | 方法   | 描述                   | 请求参数                                              | 响应结果                             |
| ------------------------ | ------ | ---------------------- | ----------------------------------------------------- | ------------------------------------ |
| /api/shop-outputs        | GET    | 获取出力数据列表       | ?date=&shop_id=&courier_id=&page=&per_page=           | { success, data, total, page_count } |
| /api/shop-outputs/:id    | GET    | 获取单条出力记录       | id                                                    | { success, data: output }            |
| /api/shop-outputs        | POST   | 创建出力记录           | { shop_id, courier_id, output_date, quantity, notes } | { success, data: { id, ... } }       |
| /api/shop-outputs/:id    | PUT    | 更新出力记录           | { shop_id, courier_id, output_date, quantity, notes } | { success, data: output }            |
| /api/shop-outputs/:id    | DELETE | 删除出力记录           | id                                                    | { success, message }                 |
| /api/shop-outputs/recent | GET    | 获取最近录入的出力数据 | ?limit=10                                             | { success, data: [output1, ...] }    |
| /api/shop-outputs/today  | GET    | 获取今日出力数据       | -                                                     | { success, data: [output1, ...] }    |

#### 1.3 统计分析 API

| 接口路径                         | 方法 | 描述                   | 请求参数                                  | 响应结果                          |
| -------------------------------- | ---- | ---------------------- | ----------------------------------------- | --------------------------------- |
| /api/stats/shop-outputs/shops    | GET  | 按店铺统计出力数据     | ?date_from=&date_to=&courier_id=          | { success, data: [stat1, ...] }   |
| /api/stats/shop-outputs/couriers | GET  | 按快递类型统计出力数据 | ?date_from=&date_to=&shop_id=             | { success, data: [stat1, ...] }   |
| /api/stats/shop-outputs/dates    | GET  | 按日期统计出力数据     | ?date_from=&date_to=&shop_id=&courier_id= | { success, data: [stat1, ...] }   |
| /api/stats/shop-outputs/total    | GET  | 获取总计数据           | ?date_from=&date_to=                      | { success, data: { total, ... } } |
| /api/stats/shop-outputs/tomorrow | GET  | 获取明日预测数据       | ?shop_id=&courier_id=                     | { success, data: [stat1, ...] }   |

### 2. 数据库迁移脚本

#### 2.1 创建 shops 表

```javascript
// create_shops_table.js
module.exports = {
  up: `
    CREATE TABLE IF NOT EXISTS shops (
      id INT AUTO_INCREMENT PRIMARY KEY,
      name VARCHAR(255) NOT NULL,
      is_active BOOLEAN DEFAULT true,
      sort_order INT DEFAULT 0,
      remark TEXT,
      created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
      updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP
    )
  `,
  down: "DROP TABLE IF EXISTS shops",
};
```

#### 2.2 创建 shop_outputs 表

```javascript
// create_shop_outputs_table.js
module.exports = {
  up: `
    CREATE TABLE IF NOT EXISTS shop_outputs (
      id INT AUTO_INCREMENT PRIMARY KEY,
      shop_id INT NOT NULL,
      courier_id INT NOT NULL,
      output_date DATE NOT NULL,
      quantity INT NOT NULL,
      notes TEXT,
      created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
      updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
      FOREIGN KEY (shop_id) REFERENCES shops(id),
      FOREIGN KEY (courier_id) REFERENCES couriers(id)
    )
  `,
  down: "DROP TABLE IF EXISTS shop_outputs",
};
```

## POST MVP / PRD 功能

- 出力数据批量导入/导出功能
- 出力计划与实际对比分析
- 出力数据异常预警
- 店铺分类管理
- 出力数据预测功能
- 与库存管理系统集成
- 不同销售渠道的数据对比分析

## 变更日志

| 变更     | 故事 ID | 描述         |
| -------- | ------- | ------------ |
| 初始草稿 | N/A     | PRD 初始版本 |
